<!-- templates/post_add.html -->
{{ define "post_add.html" }}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card shadow rounded-4">
            <div class="card-body">
                <h4 class="card-title mb-4">Добавить пост</h4>

                <form id="postForm" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label class="form-label">Автор</label>
                        <input type="text" class="form-control" name="author" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Название</label>
                        <input type="text" class="form-control" name="title" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Описание</label>
                        <textarea class="form-control" name="description" rows="4" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Фотография</label>
                        <input type="file" class="form-control" name="photo" accept="image/*" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">Отправить на модерацию</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById("postForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const form = e.target;
        const formData = new FormData(form);

        const res = await fetch("/api/posts", {
            method: "POST",
            body: formData,
            credentials: "include"
        });

        const result = await res.json();
        if (res.ok) {
            alert("Пост отправлен на модерацию");
            form.reset();
        } else {
            alert(result.error || "Ошибка при отправке поста");
        }
    });
</script>
{{ end }}
