{{ define "content" }}
<h2 class="mb-4">Пользователи</h2>
<table class="table table-striped">
    <thead>
    <tr>
        <th>ID</th>
        <th>Email</th>
        <th>Имя</th>
        <th>Роль</th>
        <th>Заблокирован</th>
        <th>Действия</th>
    </tr>
    </thead>
    <tbody id="user-table">
    <!-- Пользователи подгрузятся сюда -->
    </tbody>
</table>

<script>
    async function loadUsers() {
        const res = await fetch("/api/users", {
            headers: {
                "Authorization": "Bearer " + localStorage.getItem("token")
            }
        });
        const users = await res.json();
        const tbody = document.getElementById("user-table");
        tbody.innerHTML = "";

        users.forEach(user => {
            tbody.innerHTML += `
            <tr>
                <td>${user.ID}</td>
                <td>${user.email}</td>
                <td>${user.name}</td>
                <td>${user.role}</td>
                <td>${user.is_blocked ? "Да" : "Нет"}</td>
                <td>
                    <button class="btn btn-warning btn-sm" onclick="blockUser(${user.ID})">Блокировать</button>
                    <button class="btn btn-danger btn-sm" onclick="deleteUser(${user.ID})">Удалить</button>
                </td>
            </tr>
        `;
        });
    }

    async function blockUser(id) {
        await fetch(`/api/users/${id}/block`, {
            method: "PUT",
            headers: {
                "Authorization": "Bearer " + localStorage.getItem("token")
            }
        });
        loadUsers();
    }

    async function deleteUser(id) {
        await fetch(`/api/users/${id}`, {
            method: "DELETE",
            headers: {
                "Authorization": "Bearer " + localStorage.getItem("token")
            }
        });
        loadUsers();
    }

    document.addEventListener("DOMContentLoaded", loadUsers);
</script>
{{ end }}
