{{ define "car_add.html" }}
<h2 class="mb-4">Добавить автомобиль</h2>

<div id="carSuccess" class="alert alert-success d-none">✅ Объявление отправлено на модерацию!</div>
<div id="carError" class="alert alert-danger d-none"></div>

<form id="carForm">
    <div class="mb-3">
        <label class="form-label">Бренд</label>
        <input type="text" class="form-control" name="brand" required>
    </div>
    <div class="mb-3">
        <label class="form-label">Модель</label>
        <input type="text" class="form-control" name="model" required>
    </div>
    <div class="mb-3">
        <label class="form-label">Год выпуска</label>
        <input type="number" class="form-control" name="year" required min="1900" max="2099">
    </div>
    <div class="mb-3">
        <label class="form-label">Цена ($)</label>
        <input type="number" class="form-control" name="price" required min="0">
    </div>
    <div class="mb-3">
        <label class="form-label">Описание</label>
        <textarea class="form-control" name="description" rows="3"></textarea>
    </div>
    <div class="mb-3">
        <label class="form-label">Ссылка на изображение</label>
        <input type="url" class="form-control" name="image_url">
    </div>
    <button type="submit" class="btn btn-primary">Добавить</button>
</form>

<script>
    const form = document.getElementById("carForm");
    const successBox = document.getElementById("carSuccess");
    const errorBox = document.getElementById("carError");

    form.addEventListener("submit", async (e) => {
        e.preventDefault();
        successBox.classList.add("d-none");
        errorBox.classList.add("d-none");

        const data = {
            brand: form.brand.value.trim(),
            model: form.model.value.trim(),
            year: parseInt(form.year.value),
            price: parseFloat(form.price.value),
            description: form.description.value.trim(),
            image_url: form.image_url.value.trim()
        };

        try {
            const res = await fetch("/api/cars", {
                method: "POST",
                headers: {
                    "Authorization": "Bearer " + localStorage.getItem("token"),
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(data)
            });

            const result = await res.json();
            if (res.ok) {
                successBox.classList.remove("d-none");
                form.reset();
            } else {
                errorBox.textContent = result.error || "Произошла ошибка";
                errorBox.classList.remove("d-none");
            }
        } catch (err) {
            errorBox.textContent = "Ошибка соединения с сервером";
            errorBox.classList.remove("d-none");
        }
    });
</script>
{{ end }}
